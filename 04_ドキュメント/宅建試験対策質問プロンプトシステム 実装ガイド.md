# å®…å»ºè©¦é¨“å¯¾ç­–è³ªå•ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚·ã‚¹ãƒ†ãƒ  å®Ÿè£…ã‚¬ã‚¤ãƒ‰

**ä½œæˆè€…**: Manus AI  
**ä½œæˆæ—¥**: 2025å¹´8æœˆ15æ—¥  
**å¯¾è±¡**: ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ãƒ»é–‹ç™ºè€…

## æ¦‚è¦

æœ¬ã‚¬ã‚¤ãƒ‰ã¯ã€å®…åœ°å»ºç‰©å–å¼•å£«è©¦é¨“åˆæ ¼ã®ãŸã‚ã®æ¯æ—¥ã®è³ªå•ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’æ—¢å­˜ã®PWAã‚¢ãƒ—ãƒªï¼ˆhttps://lkebcslv.manus.space/ï¼‰ã«å®Ÿè£…ã™ã‚‹ãŸã‚ã®æ‰‹é †æ›¸ã§ã™ã€‚

## å®Ÿè£…æ‰‹é †

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æº–å‚™

#### 1.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
```sql
-- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
CREATE DATABASE takken_study_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE takken_study_system;

-- æä¾›ã•ã‚ŒãŸã‚¹ã‚­ãƒ¼ãƒã‚’ä½¿ç”¨ã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
-- ï¼ˆtakken_question_database.mdã®ã€Œå®Ÿè£…ç”¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‚ç…§ï¼‰
```

#### 1.2 åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥
```bash
# CSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥
mysql -u username -p takken_study_system < import_questions.sql

# ã¾ãŸã¯ã€CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
LOAD DATA INFILE '/path/to/takken_questions.csv'
INTO TABLE questions
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;
```

### 2. APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Ÿè£…

#### 2.1 Node.js/Express.js ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š
```javascript
// server.js
const express = require('express');
const mysql = require('mysql2/promise');
const cors = require('cors');

const app = express();
app.use(cors());
app.use(express.json());

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šè¨­å®š
const dbConfig = {
    host: 'localhost',
    user: 'your_username',
    password: 'your_password',
    database: 'takken_study_system'
};

// å•é¡Œå–å¾—API
app.get('/api/questions/:timeSlot', async (req, res) => {
    try {
        const { timeSlot } = req.params;
        const { userId, difficulty } = req.query;
        
        // é©å¿œçš„å•é¡Œé¸æŠãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
        const questions = await selectQuestions(timeSlot, userId, difficulty);
        
        res.json({
            status: 'success',
            data: {
                timeSlot,
                questions,
                metadata: {
                    totalQuestions: questions.length,
                    estimatedTotalTime: questions.reduce((sum, q) => sum + q.estimatedTime, 0)
                }
            }
        });
    } catch (error) {
        res.status(500).json({ status: 'error', message: error.message });
    }
});

// è§£ç­”é€ä¿¡API
app.post('/api/answers', async (req, res) => {
    try {
        const { userId, questionId, userAnswer, timeSlot } = req.body;
        
        // è§£ç­”å‡¦ç†ã¨çµæœè¿”å´
        const result = await processAnswer(userId, questionId, userAnswer, timeSlot);
        
        res.json({
            status: 'success',
            data: result
        });
    } catch (error) {
        res.status(500).json({ status: 'error', message: error.message });
    }
});

app.listen(3000, () => {
    console.log('Server running on port 3000');
});
```

### 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆ

#### 3.1 æ—¢å­˜PWAã‚¢ãƒ—ãƒªã®ä¿®æ­£
```javascript
// æ—¢å­˜ã®app.jsã«è¿½åŠ 
class TakkenStudySystem {
    constructor() {
        this.apiBase = '/api';
        this.currentSession = null;
    }
    
    // å­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹
    async startStudySession(timeSlot) {
        try {
            const response = await fetch(`${this.apiBase}/questions/${timeSlot}?userId=${this.getUserId()}`);
            const data = await response.json();
            
            if (data.status === 'success') {
                this.currentSession = {
                    timeSlot,
                    questions: data.data.questions,
                    currentIndex: 0,
                    startTime: new Date()
                };
                
                this.displayQuestion(this.currentSession.questions[0]);
            }
        } catch (error) {
            console.error('Failed to start study session:', error);
        }
    }
    
    // å•é¡Œè¡¨ç¤º
    displayQuestion(question) {
        const container = document.getElementById('question-container');
        container.innerHTML = `
            <div class="question-header">
                <h3>${question.category} - ${question.difficulty}</h3>
                <div class="progress">${this.currentSession.currentIndex + 1} / ${this.currentSession.questions.length}</div>
            </div>
            <div class="question-text">${question.questionText}</div>
            <div class="options">
                ${question.options.map((option, index) => `
                    <button class="option-btn" data-option="${index + 1}">
                        ${index + 1}. ${option}
                    </button>
                `).join('')}
            </div>
            <div class="learning-points">
                <h4>å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ:</h4>
                <ul>
                    ${question.learningPoints.map(point => `<li>${point}</li>`).join('')}
                </ul>
            </div>
            <div class="tips">
                <strong>ãƒ’ãƒ³ãƒˆ:</strong> ${question.tips}
            </div>
        `;
        
        // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        container.querySelectorAll('.option-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.submitAnswer(question.id, parseInt(e.target.dataset.option));
            });
        });
    }
    
    // è§£ç­”é€ä¿¡
    async submitAnswer(questionId, userAnswer) {
        try {
            const response = await fetch(`${this.apiBase}/answers`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    userId: this.getUserId(),
                    questionId,
                    userAnswer,
                    timeSlot: this.currentSession.timeSlot
                })
            });
            
            const result = await response.json();
            
            if (result.status === 'success') {
                this.showResult(result.data);
            }
        } catch (error) {
            console.error('Failed to submit answer:', error);
        }
    }
    
    // çµæœè¡¨ç¤º
    showResult(result) {
        const container = document.getElementById('result-container');
        container.innerHTML = `
            <div class="result ${result.isCorrect ? 'correct' : 'incorrect'}">
                <h3>${result.isCorrect ? 'æ­£è§£ï¼' : 'ä¸æ­£è§£'}</h3>
                <p>æ­£è§£: ${result.correctAnswer}</p>
                <div class="explanation">${result.explanation}</div>
                <div class="feedback">${result.feedback.message}</div>
                <button id="next-question" class="btn-primary">æ¬¡ã®å•é¡Œã¸</button>
            </div>
        `;
        
        document.getElementById('next-question').addEventListener('click', () => {
            this.nextQuestion();
        });
    }
    
    // æ¬¡ã®å•é¡Œã¸
    nextQuestion() {
        this.currentSession.currentIndex++;
        
        if (this.currentSession.currentIndex < this.currentSession.questions.length) {
            this.displayQuestion(this.currentSession.questions[this.currentSession.currentIndex]);
        } else {
            this.endSession();
        }
    }
    
    // ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†
    endSession() {
        // ã‚»ãƒƒã‚·ãƒ§ãƒ³çµæœã®è¡¨ç¤º
        const container = document.getElementById('session-result');
        container.innerHTML = `
            <div class="session-complete">
                <h2>å­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†ï¼</h2>
                <p>ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚ä»Šæ—¥ã®å­¦ç¿’ã‚’æŒ¯ã‚Šè¿”ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
                <button onclick="location.reload()" class="btn-primary">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
            </div>
        `;
    }
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDå–å¾—ï¼ˆå®Ÿè£…ã«å¿œã˜ã¦èª¿æ•´ï¼‰
    getUserId() {
        return localStorage.getItem('userId') || 'anonymous';
    }
}

// ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
const studySystem = new TakkenStudySystem();

// æ™‚é–“å¸¯åˆ¥å­¦ç¿’ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
document.getElementById('morning-study').addEventListener('click', () => {
    studySystem.startStudySession('morning');
});

document.getElementById('afternoon-study').addEventListener('click', () => {
    studySystem.startStudySession('afternoon');
});

document.getElementById('evening-study').addEventListener('click', () => {
    studySystem.startStudySession('evening');
});
```

### 4. ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®å®Ÿè£…

#### 4.1 Service Workerè¨­å®š
```javascript
// sw.js
self.addEventListener('push', function(event) {
    const options = {
        body: event.data.text(),
        icon: '/icon-192x192.png',
        badge: '/badge-72x72.png',
        tag: 'study-reminder',
        requireInteraction: true,
        actions: [
            {
                action: 'study',
                title: 'å­¦ç¿’ã‚’å§‹ã‚ã‚‹'
            },
            {
                action: 'later',
                title: 'å¾Œã§'
            }
        ]
    };
    
    event.waitUntil(
        self.registration.showNotification('å®…å»ºå£«è©¦é¨“å¯¾ç­–', options)
    );
});

self.addEventListener('notificationclick', function(event) {
    event.notification.close();
    
    if (event.action === 'study') {
        event.waitUntil(
            clients.openWindow('/')
        );
    }
});
```

#### 4.2 é€šçŸ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼
```javascript
// notification-scheduler.js
class NotificationScheduler {
    constructor() {
        this.studyTimes = [
            { time: '10:00', message: 'ğŸŒ… æœã®å­¦ç¿’æ™‚é–“ã§ã™ï¼åŸºç¤å›ºã‚ã‚’å§‹ã‚ã¾ã—ã‚‡ã†' },
            { time: '15:00', message: 'â˜€ï¸ æ˜¼ã®å­¦ç¿’æ™‚é–“ã§ã™ï¼ç†è§£ã‚’æ·±ã‚ã¾ã—ã‚‡ã†' },
            { time: '19:00', message: 'ğŸŒ™ å¤œã®å­¦ç¿’æ™‚é–“ã§ã™ï¼å®Ÿæˆ¦æ¼”ç¿’ã§åŠ›ã‚’è©¦ã—ã¾ã—ã‚‡ã†' }
        ];
    }
    
    async requestPermission() {
        if ('Notification' in window && 'serviceWorker' in navigator) {
            const permission = await Notification.requestPermission();
            return permission === 'granted';
        }
        return false;
    }
    
    scheduleNotifications() {
        this.studyTimes.forEach(({ time, message }) => {
            this.scheduleNotification(time, message);
        });
    }
    
    scheduleNotification(time, message) {
        const [hours, minutes] = time.split(':').map(Number);
        const now = new Date();
        const scheduledTime = new Date();
        scheduledTime.setHours(hours, minutes, 0, 0);
        
        if (scheduledTime <= now) {
            scheduledTime.setDate(scheduledTime.getDate() + 1);
        }
        
        const timeUntilNotification = scheduledTime.getTime() - now.getTime();
        
        setTimeout(() => {
            this.showNotification(message);
            this.scheduleNotification(time, message); // ç¿Œæ—¥ã®é€šçŸ¥ã‚‚è¨­å®š
        }, timeUntilNotification);
    }
    
    showNotification(message) {
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.ready.then(registration => {
                registration.showNotification('å®…å»ºå£«è©¦é¨“å¯¾ç­–', {
                    body: message,
                    icon: '/icon-192x192.png',
                    badge: '/badge-72x72.png',
                    tag: 'study-reminder'
                });
            });
        }
    }
}

// é€šçŸ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã®åˆæœŸåŒ–
const notificationScheduler = new NotificationScheduler();
notificationScheduler.requestPermission().then(granted => {
    if (granted) {
        notificationScheduler.scheduleNotifications();
    }
});
```

### 5. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

#### 5.1 æœ¬ç•ªç’°å¢ƒè¨­å®š
```bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install express mysql2 cors

# ç’°å¢ƒå¤‰æ•°è¨­å®š
export DB_HOST=your_db_host
export DB_USER=your_db_user
export DB_PASSWORD=your_db_password
export DB_NAME=takken_study_system

# ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm start
```

#### 5.2 HTTPSè¨­å®šï¼ˆå¿…é ˆï¼‰
```nginx
# nginxè¨­å®šä¾‹
server {
    listen 443 ssl;
    server_name your-domain.com;
    
    ssl_certificate /path/to/certificate.crt;
    ssl_certificate_key /path/to/private.key;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## é‹ç”¨ãƒ»ä¿å®ˆ

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
- å®šæœŸçš„ãªå•é¡Œãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°
- å­¦ç¿’å±¥æ­´ã®åˆ†æã¨ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

### 2. å•é¡Œãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 
```sql
-- æ–°ã—ã„å•é¡Œã®è¿½åŠ ä¾‹
INSERT INTO questions (
    id, subject, category, difficulty, time_slot,
    question_text, option_1, option_2, option_3, option_4,
    correct_answer, explanation, learning_points, tips, estimated_time
) VALUES (
    'R005', 'rights', 'å¥‘ç´„', 'standard', 'afternoon',
    'å¥‘ç´„ã«é–¢ã™ã‚‹æ¬¡ã®è¨˜è¿°ã®ã†ã¡...',
    'é¸æŠè‚¢1', 'é¸æŠè‚¢2', 'é¸æŠè‚¢3', 'é¸æŠè‚¢4',
    2, 'è§£èª¬æ–‡', '["å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ1", "å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ2"]', 'ãƒ’ãƒ³ãƒˆ', 240
);
```

### 3. çµ±è¨ˆãƒ»åˆ†æ
```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥æ­£ç­”ç‡
SELECT 
    user_id,
    COUNT(*) as total_questions,
    SUM(CASE WHEN is_correct THEN 1 ELSE 0 END) as correct_answers,
    ROUND(SUM(CASE WHEN is_correct THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as accuracy_rate
FROM learning_history
GROUP BY user_id
ORDER BY accuracy_rate DESC;

-- ç§‘ç›®åˆ¥é›£æ˜“åº¦åˆ†æ
SELECT 
    q.subject,
    q.difficulty,
    COUNT(*) as total_attempts,
    SUM(CASE WHEN lh.is_correct THEN 1 ELSE 0 END) as correct_attempts,
    ROUND(SUM(CASE WHEN lh.is_correct THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as accuracy_rate
FROM questions q
JOIN learning_history lh ON q.id = lh.question_id
GROUP BY q.subject, q.difficulty
ORDER BY q.subject, q.difficulty;
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

1. **é€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œãªã„**
   - HTTPSç’°å¢ƒã§å‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèª
   - ãƒ–ãƒ©ã‚¦ã‚¶ã®é€šçŸ¥è¨±å¯è¨­å®šã‚’ç¢ºèª
   - Service Workerã®ç™»éŒ²çŠ¶æ³ã‚’ç¢ºèª

2. **å•é¡ŒãŒè¡¨ç¤ºã•ã‚Œãªã„**
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚’ç¢ºèª
   - APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹•ä½œã‚’ç¢ºèª
   - ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

3. **å­¦ç¿’é€²æ—ãŒä¿å­˜ã•ã‚Œãªã„**
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã®è¨­å®šã‚’ç¢ºèª
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ›¸ãè¾¼ã¿æ¨©é™ã‚’ç¢ºèª
   - APIã®è§£ç­”é€ä¿¡å‡¦ç†ã‚’ç¢ºèª

ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€åŠ¹æœçš„ãªå®…å»ºè©¦é¨“å¯¾ç­–ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

