# 宅地建物取引士試験 質問プロンプトシステム 実装ガイド

## 目次

1. [概要](#概要)
2. [システムアーキテクチャ](#システムアーキテクチャ)
3. [API仕様](#api仕様)
4. [PWAアプリとの連携方法](#pwaアプリとの連携方法)
5. [データベース設計](#データベース設計)
6. [プッシュ通知の実装](#プッシュ通知の実装)
7. [間隔反復学習アルゴリズム](#間隔反復学習アルゴリズム)
8. [セキュリティ考慮事項](#セキュリティ考慮事項)
9. [デプロイメント手順](#デプロイメント手順)
10. [トラブルシューティング](#トラブルシューティング)

---

## 概要

本実装ガイドは、宅地建物取引士試験合格のための毎日の質問プロンプトシステムの技術仕様と実装方法を詳細に説明します。このシステムは、間隔反復学習理論と認知負荷理論に基づいて設計され、既存のPWAアプリ（`https://lkebcslv.manus.space/`）と連携して効率的な学習習慣の確立を支援します。

### 主要機能

- **時間帯別質問配信**: 朝（10:00）、昼（15:00）、夜（19:00）の3つの学習フェーズに応じた質問の自動配信
- **適応的問題選択**: 学習者の解答履歴と間隔反復学習アルゴリズム（SM-2）に基づく最適な問題選択
- **学習進捗管理**: 科目別・時間帯別の詳細な学習進捗の記録と分析
- **プッシュ通知**: 学習時間のリマインドと質問プロンプトの自動配信
- **PWAアプリ連携**: 既存のPWAアプリとのシームレスなデータ連携

### 技術スタック

- **バックエンド**: Flask (Python)
- **データベース**: SQLite (開発環境) / PostgreSQL (本番環境推奨)
- **フロントエンド連携**: RESTful API
- **プッシュ通知**: Web Push API / Firebase Cloud Messaging
- **認証**: OAuth2.0 / JWT
- **デプロイメント**: Docker / Heroku / AWS

---


## システムアーキテクチャ

本システムは、マイクロサービスアーキテクチャの原則に基づいて設計されており、各コンポーネントが独立して動作し、明確に定義されたAPIを通じて連携します。

### アーキテクチャ図

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   PWA アプリ     │    │  プッシュ通知    │    │   管理画面      │
│ (既存システム)   │    │   サービス      │    │  (オプション)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │ HTTPS/REST API        │ Web Push API          │ HTTPS/REST API
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────────────────────────────────────────────────────┐
│                    質問プロンプトシステム                        │
│                        (Flask API)                            │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐ │
│  │質問生成・選択│  │学習進捗管理 │  │プッシュ通知 │  │認証・認可│ │
│  │   エンジン   │  │ モジュール  │  │ モジュール  │  │モジュール│ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘ │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
                    ┌─────────────────┐
                    │  データベース    │
                    │ (SQLite/PostgreSQL) │
                    │ ・質問データ     │
                    │ ・学習進捗      │
                    │ ・ユーザー情報   │
                    └─────────────────┘
```

### コンポーネント詳細

#### 1. 質問生成・選択エンジン

質問生成・選択エンジンは、システムの中核となるコンポーネントで、以下の責務を担います。

**主要機能:**
- 時間帯に応じた適切な質問の選択
- 間隔反復学習アルゴリズム（SM-2）の実装
- 学習者の習熟度に基づく難易度調整
- 科目別バランスの考慮

**実装詳細:**
```python
def select_question(time_slot, user_id):
    """
    指定された時間帯とユーザーに最適な質問を選択
    
    Args:
        time_slot (str): 'morning', 'noon', 'evening'
        user_id (str): ユーザーID
    
    Returns:
        Question: 選択された質問オブジェクト
    """
    # 1. 復習すべき問題の優先選択
    review_questions = get_due_questions(user_id, time_slot)
    
    if review_questions:
        # E-Factorが低い（難しい）問題を優先
        return min(review_questions, key=lambda q: q.e_factor)
    
    # 2. 新しい問題の選択
    new_questions = get_new_questions(time_slot)
    
    if new_questions:
        return random.choice(new_questions)
    
    # 3. フォールバック: 時間帯に合った問題をランダム選択
    return get_random_question(time_slot)
```

#### 2. 学習進捗管理モジュール

学習進捗管理モジュールは、学習者の解答履歴と進捗状況を詳細に記録・分析します。

**主要機能:**
- 解答履歴の記録
- 科目別・時間帯別の正答率計算
- 学習時間の追跡
- 進捗レポートの生成

**データ構造:**
```python
class UserProgress:
    user_id: str
    question_id: int
    selected_choice: int
    is_correct: bool
    time_taken: int  # 秒
    answered_at: datetime
```

#### 3. プッシュ通知モジュール

プッシュ通知モジュールは、学習時間のリマインドと質問プロンプトの配信を担当します。

**主要機能:**
- 定時通知の送信（10:00, 15:00, 19:00）
- 通知内容のカスタマイズ
- 通知購読の管理
- 配信状況の追跡

**通知スケジュール:**
- **朝（10:00）**: "🌅 朝の学習時間です！基礎固めの問題に挑戦しましょう。"
- **昼（15:00）**: "☀️ 昼の学習時間です！理解を深める問題に取り組みましょう。"
- **夜（19:00）**: "🌙 夜の学習時間です！実戦演習で応用力を鍛えましょう。"

#### 4. 認証・認可モジュール

認証・認可モジュールは、セキュアなAPI アクセスを保証します。

**主要機能:**
- JWT トークンベースの認証
- APIキーによるアクセス制御
- ユーザー権限の管理
- セッション管理

---

